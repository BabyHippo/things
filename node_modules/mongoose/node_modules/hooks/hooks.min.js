module.exports={hook:function(d,b,a){if(arguments.length===1&&typeof d==="object"){for(var c in d){this.hook(c,d[c])}return}var g=this.prototype||this,f=g._pres=g._pres||{},e=g._posts=g._posts||{};f[d]=f[d]||[];e[d]=e[d]||[];g[d]=function(){var s=this,o,p=arguments[arguments.length-1],r=this._pres[d],q=this._posts[d],m=r.length,j=-1,i=g[d].numAsyncPres,l=function(){if(arguments[0] instanceof Error){return n(arguments[0])}var t=Array.prototype.slice.call(arguments),u,v;if(t.length&&!(arguments[0]==null&&typeof p==="function")){o=t}if(++j<m){u=r[j];if(u.isAsync&&u.length<2){throw new Error("Your pre must have next and done arguments -- e.g., function (next, done, ...)")}if(u.length<1){throw new Error("Your pre must have a next argument -- e.g., function (next, ...)")}v=(u.isAsync?[once(l),once(h)]:[once(l)]).concat(o);return u.apply(s,v)}else{if(!g[d].numAsyncPres){return k.apply(s,o)}}},k=function(){var t=Array.prototype.slice.call(arguments),y,z,u,w,v,x;if(j===m){y=b.apply(s,t);z=q.length;u=-1;w=function(){if(arguments[0] instanceof Error){return n(arguments[0])}var A=Array.prototype.slice.call(arguments,1),B,C;if(A.length){o=A}if(++u<z){B=q[u];if(B.length<1){throw new Error("Your post must have a next argument -- e.g., function (next, ...)")}C=[once(w)].concat(o);return B.apply(s,C)}};if(z){return w()}return y}};if(i){function h(t){if(t&&t instanceof Error){return n(t)}--i||k.apply(s,o)}}function n(t){if("function"==typeof p){return p(t)}if(a){return a.call(s,t)}throw t}return l.apply(this,arguments)};g[d].numAsyncPres=0;return this},pre:function(d,c,b,a){if("boolean"!==typeof arguments[1]){a=b;b=c;c=false}var f=this.prototype||this,e=f._pres=f._pres||{};this._lazySetupHooks(f,d,a);if(b.isAsync=c){f[d].numAsyncPres++}(e[d]=e[d]||[]).push(b);return this},post:function(c,b,a){if(arguments.length===2){a=b;b=false}var e=this.prototype||this,d=e._posts=e._posts||{};this._lazySetupHooks(e,c);(d[c]=d[c]||[]).push(a);return this},removePre:function(b,a){var d=this.prototype||this,c=d._pres||(d._pres||{});if(!c[b]){return this}if(arguments.length===1){c[b].length=0}else{c[b]=c[b].filter(function(e){return e!==a})}return this},_lazySetupHooks:function(c,b,a){if("undefined"===typeof c[b].numAsyncPres){this.hook(b,c[b],a)}}};function once(a,c){return function b(){if(b.hookCalled){return}b.hookCalled=true;a.apply(c,arguments)}};