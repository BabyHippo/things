var chr=String.fromCharCode;var maxBits=[];for(var i=0;i<64;i++){maxBits[i]=Math.pow(2,i)}function BinaryParser(b,a){if(!(this instanceof BinaryParser)){return new BinaryParser(b,a)}this.bigEndian=b;this.allowExceptions=a}BinaryParser.warn=function warn(a){if(this.allowExceptions){throw new Error(a)}return 1};BinaryParser.decodeFloat=function decodeFloat(f,l,j){var a=new this.Buffer(this.bigEndian,f);a.checkBuffer(l+j+1);var c=maxBits[j-1]-1,m=a.readBits(l+j,1),h=a.readBits(l,j),n=0,g=2,e=a.buffer.length+(-l>>3)-1;do{for(var d=a.buffer[++e],o=l%8||8,k=1<<o;k>>=1;(d&k)&&(n+=1/g),g*=2){}}while(l-=o);return h==(c<<1)+1?n?NaN:m?-Infinity:+Infinity:(1+m*-2)*(h||n?!h?Math.pow(2,-c+1)*n:Math.pow(2,h-c)*(1+n):0)};BinaryParser.decodeInt=function decodeInt(d,c,g,e){var a=new this.Buffer(this.bigEndian||e,d),h=a.readBits(0,c),f=maxBits[c];return g&&h>=f/2?h-f:h};BinaryParser.encodeFloat=function encodeFloat(c,t,e){var a=maxBits[e-1]-1,p=-a+1,o=a,q=p-t,s=parseFloat(c),x=isNaN(s)||s==-Infinity||s==+Infinity?s:0,d=0,m=2*a+1+t+3,b=new Array(m),w=(s=x!==0?0:s)<0,h=Math.floor(s=Math.abs(s)),f=s-h,l,v,u,g,k;for(g=m;g;b[--g]=0){}for(g=a+2;h&&g;b[--g]=h%2,h=Math.floor(h/2)){}for(g=a+1;f>0&&g;(b[++g]=((f*=2)>=1)-0)&&--f){}for(g=-1;++g<m&&!b[g];){}if(b[(l=t-1+(g=(d=a+1-g)>=p&&d<=o?g+1:a+1-(d=p-1)))+1]){if(!(v=b[l])){for(k=l+2;!v&&k<m;v=b[k++]){}}for(k=l+1;v&&--k>=0;(b[k]=!b[k]-0)&&(v=0)){}}for(g=g-2<0?-1:g-3;++g<m&&!b[g];){}if((d=a+1-g)>=p&&d<=o){++g}else{if(d<p){d!=a+1-m&&d<q&&this.warn("encodeFloat::float underflow");g=a+1-(d=p-1)}}if(h||x!==0){this.warn(h?"encodeFloat::float overflow":"encodeFloat::"+x);d=o+1;g=a+2;if(x==-Infinity){w=1}else{if(isNaN(x)){b[g]=1}}}for(s=Math.abs(d+a),k=e+1,u="";--k;u=(s%2)+u,s=s>>=1){}for(s=0,k=0,g=(u=(w?"1":"0")+u+b.slice(g,g+t).join("")).length,r=[];g;k=(k+1)%8){s+=(1<<k)*u.charAt(--g);if(k==7){r[r.length]=String.fromCharCode(s);s=0}}r[r.length]=s?String.fromCharCode(s):"";return(this.bigEndian?r.reverse():r).join("")};BinaryParser.encodeInt=function encodeInt(b,a,f,c){var d=maxBits[a];if(b>=d||b<-(d/2)){this.warn("encodeInt::overflow");b=0}if(b<0){b+=d}for(var e=[];b;e[e.length]=String.fromCharCode(b%256),b=Math.floor(b/256)){}for(a=-(-a>>3)-e.length;a--;e[e.length]="\0"){}return((this.bigEndian||c)?e.reverse():e).join("")};BinaryParser.toSmall=function(a){return this.decodeInt(a,8,true)};BinaryParser.fromSmall=function(a){return this.encodeInt(a,8,true)};BinaryParser.toByte=function(a){return this.decodeInt(a,8,false)};BinaryParser.fromByte=function(a){return this.encodeInt(a,8,false)};BinaryParser.toShort=function(a){return this.decodeInt(a,16,true)};BinaryParser.fromShort=function(a){return this.encodeInt(a,16,true)};BinaryParser.toWord=function(a){return this.decodeInt(a,16,false)};BinaryParser.fromWord=function(a){return this.encodeInt(a,16,false)};BinaryParser.toInt=function(a){return this.decodeInt(a,32,true)};BinaryParser.fromInt=function(a){return this.encodeInt(a,32,true)};BinaryParser.toLong=function(a){return this.decodeInt(a,64,true)};BinaryParser.fromLong=function(a){return this.encodeInt(a,64,true)};BinaryParser.toDWord=function(a){return this.decodeInt(a,32,false)};BinaryParser.fromDWord=function(a){return this.encodeInt(a,32,false)};BinaryParser.toQWord=function(a){return this.decodeInt(a,64,true)};BinaryParser.fromQWord=function(a){return this.encodeInt(a,64,true)};BinaryParser.toFloat=function(a){return this.decodeFloat(a,23,8)};BinaryParser.fromFloat=function(a){return this.encodeFloat(a,23,8)};BinaryParser.toDouble=function(a){return this.decodeFloat(a,52,11)};BinaryParser.fromDouble=function(a){return this.encodeFloat(a,52,11)};BinaryParser.encode_int32=function encode_int32(k,f){var e,g,h,j,l;l=(k<0)?(k+4294967296):k;e=Math.floor(l/16777215);l&=16777215;g=Math.floor(l/65535);l&=65535;h=Math.floor(l/255);l&=255;j=Math.floor(l);return f?[chr(e),chr(g),chr(h),chr(j)]:chr(e)+chr(g)+chr(h)+chr(j)};BinaryParser.encode_int64=function encode_int64(s){var j,k,l,m,n,o,p,q,t;t=(s<0)?(s+1.844674407370955e+19):s;j=Math.floor(t/7.205759403792794e+16);t&=7.205759403792794e+16;k=Math.floor(t/281474976710655);t&=281474976710655;l=Math.floor(t/1099511627775);t&=1099511627775;m=Math.floor(t/4294967295);t&=4294967295;n=Math.floor(t/16777215);t&=16777215;o=Math.floor(t/65535);t&=65535;p=Math.floor(t/255);t&=255;q=Math.floor(t);return chr(j)+chr(k)+chr(l)+chr(m)+chr(n)+chr(o)+chr(p)+chr(q)};BinaryParser.decode_utf8=function decode_utf8(a){var j=a.length,g="",h=0,b=0,d=0,e=0,f;while(h<j){b=a.charCodeAt(h);if(b<128){g+=String.fromCharCode(b);h++}else{if((b>191)&&(b<224)){e=a.charCodeAt(h+1);g+=String.fromCharCode(((b&31)<<6)|(e&63));h+=2}else{e=a.charCodeAt(h+1);f=a.charCodeAt(h+2);g+=String.fromCharCode(((b&15)<<12)|((e&63)<<6)|(f&63));h+=3}}}return g};BinaryParser.encode_cstring=function encode_cstring(a){return unescape(encodeURIComponent(a))+BinaryParser.fromByte(0)};BinaryParser.encode_utf8=function encode_utf8(g){var b="",d;for(var f=0,e=g.length;f<e;f++){d=g.charCodeAt(f);if(d<128){b+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){b+=String.fromCharCode((d>>6)|192);b+=String.fromCharCode((d&63)|128)}else{b+=String.fromCharCode((d>>12)|224);b+=String.fromCharCode(((d>>6)&63)|128);b+=String.fromCharCode((d&63)|128)}}}return b};BinaryParser.hprint=function hprint(d){var c;for(var a=0,b=d.length;a<b;a++){if(d.charCodeAt(a)<32){c=d.charCodeAt(a)<=15?"0"+d.charCodeAt(a).toString(16):d.charCodeAt(a).toString(16);process.stdout.write(c+" ")}else{c=d.charCodeAt(a)<=15?"0"+d.charCodeAt(a).toString(16):d.charCodeAt(a).toString(16);process.stdout.write(c+" ")}}process.stdout.write("\n\n")};BinaryParser.ilprint=function hprint(d){var c;for(var a=0,b=d.length;a<b;a++){if(d.charCodeAt(a)<32){c=d.charCodeAt(a)<=15?"0"+d.charCodeAt(a).toString(10):d.charCodeAt(a).toString(10);require("util").debug(c+" : ")}else{c=d.charCodeAt(a)<=15?"0"+d.charCodeAt(a).toString(10):d.charCodeAt(a).toString(10);require("util").debug(c+" : "+d.charAt(a))}}};BinaryParser.hlprint=function hprint(d){var c;for(var a=0,b=d.length;a<b;a++){if(d.charCodeAt(a)<32){c=d.charCodeAt(a)<=15?"0"+d.charCodeAt(a).toString(16):d.charCodeAt(a).toString(16);require("util").debug(c+" : ")}else{c=d.charCodeAt(a)<=15?"0"+d.charCodeAt(a).toString(16):d.charCodeAt(a).toString(16);require("util").debug(c+" : "+d.charAt(a))}}};function BinaryParserBuffer(a,b){this.bigEndian=a||0;this.buffer=[];this.setBuffer(b)}BinaryParserBuffer.prototype.setBuffer=function setBuffer(c){var e,d,a;if(c){d=e=c.length;a=this.buffer=new Array(e);for(;d;a[e-d]=c.charCodeAt(--d)){}this.bigEndian&&a.reverse()}};BinaryParserBuffer.prototype.hasNeededBits=function hasNeededBits(a){return this.buffer.length>=-(-a>>3)};BinaryParserBuffer.prototype.checkBuffer=function checkBuffer(a){if(!this.hasNeededBits(a)){throw new Error("checkBuffer::missing bytes")}};BinaryParserBuffer.prototype.readBits=function readBits(h,d){function g(k,l){for(;l--;k=((k%=2147483647+1)&1073741824)==1073741824?k*2:(k-1073741824)*2+2147483647+1){}return k}if(h<0||d<=0){return 0}this.checkBuffer(h+d);var e,f=h%8,a=this.buffer.length-(h>>3)-1,c=this.buffer.length+(-(h+d)>>3),b=a-c,j=((this.buffer[a]>>f)&((1<<(b?8-f:d))-1))+(b&&(e=(h+d)%8)?(this.buffer[c++]&((1<<e)-1))<<(b--<<3)-f:0);for(;b;j+=g(this.buffer[c++],(b--<<3)-f)){}return j};BinaryParser.Buffer=BinaryParserBuffer;if(typeof window==="undefined"){exports.BinaryParser=BinaryParser};