/*
 * Module dependencies.
 */
var Collection=require("./collection").Collection,Cursor=require("./cursor").Cursor,DbCommand=require("./commands/db_command").DbCommand;function Admin(a){if(!(this instanceof Admin)){return new Admin(a)}this.db=a}Admin.prototype.buildInfo=function(a){this.serverInfo(a)};Admin.prototype.serverInfo=function(a){this.db.executeDbAdminCommand({buildinfo:1},function(c,b){if(c!=null){return a(c,null)}return a(null,b.documents[0])})};Admin.prototype.serverStatus=function(a){var b=this;this.db.executeDbAdminCommand({serverStatus:1},function(d,c){if(d==null&&c.documents[0].ok===1){a(null,c.documents[0])}else{if(d){return a(d,false)}return a(b.wrap(c.documents[0]),false)}})};Admin.prototype.profilingLevel=function(a){var b=this;this.db.executeDbAdminCommand({profile:-1},function(d,c){c=c.documents[0];if(d==null&&c.ok===1){var e=c.was;if(e==0){return a(null,"off")}if(e==1){return a(null,"slow_only")}if(e==2){return a(null,"all")}return a(new Error("Error: illegal profiling level value "+e),null)}else{d!=null?a(d,null):a(new Error("Error with profile command"),null)}})};Admin.prototype.ping=function(c,b){var a=Array.prototype.slice.call(arguments,0);b=a.pop();this.db.executeDbAdminCommand({ping:1},b)};Admin.prototype.authenticate=function(c,b,a){this.db.authenticate(c,b,{authdb:"admin"},function(e,d){return a(e,d)})};Admin.prototype.logout=function(a){this.db.logout({authdb:"admin"},function(c,b){return a(c,b)})};Admin.prototype.addUser=function(e,d,c,b){var a=Array.prototype.slice.call(arguments,2);b=a.pop();c=a.length?a.shift():{};c.dbName="admin";this.db.addUser(e,d,c,function(g,f){return b(g,f)})};Admin.prototype.removeUser=function(e,c,b){var d=this;var a=Array.prototype.slice.call(arguments,1);b=a.pop();c=a.length?a.shift():{};c.dbName="admin";this.db.removeUser(e,c,function(g,f){return b(g,f)})};Admin.prototype.setProfilingLevel=function(c,a){var e=this;var b={};var d=0;if(c=="off"){d=0}else{if(c=="slow_only"){d=1}else{if(c=="all"){d=2}else{return a(new Error("Error: illegal profiling level value "+c))}}}b.profile=d;this.db.executeDbAdminCommand(b,function(g,f){f=f.documents[0];if(g==null&&f.ok===1){return a(null,c)}return g!=null?a(g,null):a(new Error("Error with profile command"),null)})};Admin.prototype.profilingInfo=function(a){try{new Cursor(this.db,new Collection(this.db,DbCommand.SYSTEM_PROFILE_COLLECTION),{},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"admin").toArray(function(c,d){return a(c,d)})}catch(b){return a(b,null)}};Admin.prototype.command=function(c,d,b){var e=this;var a=Array.prototype.slice.call(arguments,1);b=a.pop();d=a.length?a.shift():{};this.db.executeDbAdminCommand(c,d,function(g,f){return b!=null?b(g,f):null})};Admin.prototype.validateCollection=function(c,g,b){var a=Array.prototype.slice.call(arguments,1);b=a.pop();g=a.length?a.shift():{};var h=this;var d={validate:c};var f=Object.keys(g);for(var e=0;e<f.length;e++){if(g.hasOwnProperty(f[e])){d[f[e]]=g[f[e]]}}this.db.executeDbCommand(d,function(j,i){if(j!=null){return b(j,null)}i=i.documents[0];if(i.ok===0){return b(new Error("Error with validate command"),null)}if(i.result!=null&&i.result.constructor!=String){return b(new Error("Error with validation data"),null)}if(i.result!=null&&i.result.match(/exception|corrupt/)!=null){return b(new Error("Error: invalid collection "+c),null)}if(i.valid!=null&&!i.valid){return b(new Error("Error: invalid collection "+c),null)}return b(null,i)})};Admin.prototype.listDatabases=function(a){this.db.executeDbAdminCommand({listDatabases:1},{},function(c,b){if(c!=null){return a(c,null)}return a(null,b.documents[0])})};Admin.prototype.replSetGetStatus=function(a){var b=this;this.db.executeDbAdminCommand({replSetGetStatus:1},function(d,c){if(d==null&&c.documents[0].ok===1){return a(null,c.documents[0])}if(d){return a(d,false)}return a(b.db.wrap(c.documents[0]),false)})};exports.Admin=Admin;