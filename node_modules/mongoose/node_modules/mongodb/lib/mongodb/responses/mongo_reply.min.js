var Long=require("bson").Long;var MongoReply=exports.MongoReply=function(){this.documents=[];this.index=0};MongoReply.prototype.parseHeader=function(a,b){this.messageLength=a[this.index]|a[this.index+1]<<8|a[this.index+2]<<16|a[this.index+3]<<24;this.index=this.index+4;this.requestId=a[this.index]|a[this.index+1]<<8|a[this.index+2]<<16|a[this.index+3]<<24;this.index=this.index+4;this.responseTo=a[this.index]|a[this.index+1]<<8|a[this.index+2]<<16|a[this.index+3]<<24;this.index=this.index+4+4;this.responseFlag=a[this.index]|a[this.index+1]<<8|a[this.index+2]<<16|a[this.index+3]<<24;this.index=this.index+4;var d=a[this.index]|a[this.index+1]<<8|a[this.index+2]<<16|a[this.index+3]<<24;this.index=this.index+4;var c=a[this.index]|a[this.index+1]<<8|a[this.index+2]<<16|a[this.index+3]<<24;this.index=this.index+4;this.cursorId=new Long(d,c);this.startingFrom=a[this.index]|a[this.index+1]<<8|a[this.index+2]<<16|a[this.index+3]<<24;this.index=this.index+4;this.numberReturned=a[this.index]|a[this.index+1]<<8|a[this.index+2]<<16|a[this.index+3]<<24;this.index=this.index+4};MongoReply.prototype.parseBody=function(b,c,l,e){l=l==null?false:l;var f=1024*20;if(this.messageLength>f){var a=this.numberReturned;this.documents=new Array(this.numberReturned);for(var h=50;h>0;h--){if((this.numberReturned/h)>=1){a=h;break}}var k=function(o,m,i,n){var p=0;var q=function(){if((n-p)<i){i=n-p}if(l){for(var t=0;t<i;t++){if(p<=n){var r=m[o.index]|m[o.index+1]<<8|m[o.index+2]<<16|m[o.index+3]<<24;o.documents[p]=b.slice(o.index,o.index+r);o.index=o.index+r;p=p+1}}}else{try{o.index=c.deserializeStream(b,o.index,i,o.documents,p);p=p+i}catch(s){return e(s)}}if(p<n){process.nextTick(q)}else{e(null)}};return q}(this,b,a,this.numberReturned)()}else{try{for(var j=0;j<this.numberReturned;j++){var d=b[this.index]|b[this.index+1]<<8|b[this.index+2]<<16|b[this.index+3]<<24;if(l){this.documents.push(b.slice(this.index,this.index+d))}else{this.documents.push(c.deserialize(b.slice(this.index,this.index+d)))}this.index=this.index+d}}catch(g){return e(g)}e(null)}};MongoReply.prototype.is_error=function(){if(this.documents.length==1){return this.documents[0].ok==1?false:true}return false};MongoReply.prototype.error_message=function(){return this.documents.length==1&&this.documents[0].ok==1?"":this.documents[0].errmsg};