var Stream=require("stream").Stream,util=require("util");function ReadStream(a,b){if(!(this instanceof ReadStream)){return new ReadStream(a,b)}Stream.call(this);this.autoclose=!!a;this.gstore=b;this.finalLength=b.length-b.position;this.completedLength=0;this.currentChunkNumber=0;this.paused=false;this.readable=true;this.pendingChunk=null;this.executing=false;this.numberOfChunks=Math.ceil(b.length/b.chunkSize);var c=this;process.nextTick(function(){c._execute()})}ReadStream.prototype.__proto__=Stream.prototype;ReadStream.prototype.readable;ReadStream.prototype.paused;ReadStream.prototype._execute=function(){if(this.paused===true||this.readable===false){return}var b=this.gstore;var d=this;this.executing=true;var c=false;var e=0;if(b.currentChunk.chunkNumber>=(this.numberOfChunks-1)){d.executing=false;c=true}var a=b.currentChunk.readSlice(b.currentChunk.length());if(a!=null&&b.currentChunk.chunkNumber==d.currentChunkNumber){d.currentChunkNumber=d.currentChunkNumber+1;d.completedLength+=a.length;d.pendingChunk=null;d.emit("data",a)}if(c===true){d.readable=false;d.emit("end");if(d.autoclose===true){if(b.mode[0]=="w"){b.close(function(g,f){if(g){d.emit("error",g);return}d.readable=false;d.emit("close",f)})}else{d.readable=false;d.emit("close")}}}else{b._nthChunk(b.currentChunk.chunkNumber+1,function(g,f){if(g){d.readable=false;d.emit("error",g);d.executing=false;return}d.pendingChunk=f;if(d.paused===true){d.executing=false;return}b.currentChunk=d.pendingChunk;d._execute()})}};ReadStream.prototype.pause=function(){if(!this.executing){this.paused=true}};ReadStream.prototype.destroy=function(){this.readable=false;this.emit("close")};ReadStream.prototype.resume=function(){if(this.paused===false||!this.readable){return}this.paused=false;var a=this;process.nextTick(function(){a._execute()})};exports.ReadStream=ReadStream;