var mongoose=require("../"),Mongoose=mongoose.Mongoose,Collection=mongoose.Collection,assert=require("assert"),startTime=Date.now(),queryCount=0,opened=0,closed=0;["ensureIndex","findAndModify","findOne","find","insert","save","update","remove","count","distinct","isCapped","options"].forEach(function(a){var b=Collection.prototype[a];Collection.prototype[a]=function(){queryCount++;return b.apply(this,arguments)}});var oldOnOpen=Collection.prototype.onOpen;Collection.prototype.onOpen=function(){opened++;return oldOnOpen.apply(this,arguments)};var oldOnClose=Collection.prototype.onClose;Collection.prototype.onClose=function(){closed++;return oldOnClose.apply(this,arguments)};module.exports=function(c){c||(c={});var d;if(c.uri){d=c.uri;delete c.uri}else{d=process.env.MONGOOSE_TEST_URI||"mongodb://localhost/mongoose_test"}var b=!!c.noErrorListener;delete c.noErrorListener;var a=mongoose.createConnection(d,c);if(b){return a}a.on("error",function(e){assert.ok(e)});return a};module.exports.mongoose=mongoose;