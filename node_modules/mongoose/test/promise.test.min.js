var assert=require("assert");var Promise=require("../lib/promise");describe("promise",function(){it("events fire right after complete()",function(){var b=new Promise(),a=0;b.on("complete",function(c,d){assert.equal(c,"1");assert.equal(d,"2");a++});b.complete("1","2");b.on("complete",function(c,d){assert.equal(c,"1");assert.equal(d,"2");a++});assert.equal(2,a)});it("events first right after error()",function(){var b=new Promise(),a=0;b.on("err",function(c){assert.ok(c instanceof Error);a++});b.error(new Error("booyah"));b.on("err",function(c){assert.ok(c instanceof Error);a++});assert.equal(2,a)});describe("errback+callback",function(){it("from constructor works",function(){var a=0;var b=new Promise(function(c){assert.ok(c instanceof Error);a++});b.error(new Error("dawg"));assert.equal(1,a)});it("after complete()",function(){var b=new Promise(),a=0;b.complete("woot");b.addBack(function(d,c){assert.equal(c,"woot");a++});b.addBack(function(d,c){assert.strictEqual(d,null);a++});assert.equal(2,a)});it("after error()",function(){var b=new Promise(),a=0;b.error(new Error("woot"));b.addBack(function(c){assert.ok(c instanceof Error);a++});b.addBack(function(c){assert.ok(c instanceof Error);a++});assert.equal(2,a)})});describe("addCallback shortcut",function(){it("works",function(){var b=new Promise(),a=0;b.addCallback(function(c){assert.strictEqual(c,undefined);a++});b.complete();assert.equal(1,a)})});describe("addErrback shortcut",function(){var b=new Promise(),a=0;b.addErrback(function(c){assert.ok(c instanceof Error);a++});b.error(new Error);assert.equal(1,a)});describe("return values",function(){it("on()",function(){var a=new Promise();assert.ok(a.on("jump",function(){}) instanceof Promise)});it("addCallback()",function(){var a=new Promise();assert.ok(a.addCallback(function(){}) instanceof Promise)});it("addErrback()",function(){var a=new Promise();assert.ok(a.addErrback(function(){}) instanceof Promise)});it("addBack()",function(){var a=new Promise();assert.ok(a.addBack(function(){}) instanceof Promise)})})});